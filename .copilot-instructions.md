# Copilot Instructions for Graston Dashboard

## Project Overview
This repository hosts the **Graston Dashboard**, an internal staff tool replacing Forest Admin for managing training events, rosters, and compliance. This is a staff-only application with strict access controls.

## Technology Stack
- **Frontend Framework**: Next.js with TypeScript (App Router disabled for now)
- **UI Library**: Material UI (MUI) with MUI DataGrid for tables
- **Authentication**: NextAuth with Google Workspace provider
- **Data Fetching**: SWR + Axios
- **Data Export**: PapaParse + FileSaver for CSV exports
- **Domain Restriction**: Authentication limited to `@grastontechnique.com` emails only

## API Integration
- **Primary API**: WordPress REST API (`/wp-json/graston/v1`) using Basic Auth
- **Future Integration**: WooCommerce endpoints for instrument/order lookups
- **Security**: API credentials stored in environment variables, never exposed client-side

## Core Features

### 1. Events Overview Page
- Display upcoming and past training events in a searchable, filterable table
- Include columns for: event name, date, instructors, CEU credits, risk level
- Risk badges: High/Medium/Low visual indicators
- Search functionality across all event fields
- Filter options for date ranges, instructors, risk levels
- Export all events to CSV functionality

### 2. Event Detail Page
- Show comprehensive event metadata (name, date, instructors, CEU credits)
- Display roster table with participant information:
  - Participant name
  - License number and state
  - Certification level
  - Occupation
  - Instrument purchase status
  - Masked email addresses (unmask only when authorized)
  - LearnDash precourse progress
  - Associated clinic information
- Export roster to CSV with proper email masking

### 3. Authentication & Authorization
- Staff-only access via NextAuth + Google OAuth
- Strict domain restriction to `@grastontechnique.com`
- Secure session management
- Proper logout functionality

## Development Guidelines

### Code Style & Architecture
- Use TypeScript throughout the application
- Implement functional components with React hooks
- Follow consistent naming conventions (camelCase for variables/functions, PascalCase for components)
- Use SWR for data fetching with proper error handling and loading states
- Implement proper error boundaries and user feedback

### File Structure
```
/pages/
  /api/          # API routes for backend communication
  index.tsx      # Events overview page
  /events/
    [id].tsx     # Event detail page
/components/     # Reusable UI components
/lib/           # Utility functions and API helpers
/types/         # TypeScript type definitions
/styles/        # Global styles and theme configuration
```

### UI/UX Standards
- Use Material UI components consistently throughout the application
- Implement responsive design for desktop and tablet usage
- Use MUI DataGrid for all table displays with proper pagination
- Maintain consistent spacing and typography using MUI theme
- Implement loading states and error handling for all data operations
- Use appropriate MUI icons and color scheme

### Security Requirements
- **API Security**: Never expose WordPress credentials or API keys client-side
- **Email Privacy**: Mask email addresses by default in all exports and displays
- **Access Control**: Verify domain restriction on both client and server sides
- **Data Protection**: Implement proper input validation and sanitization
- **Environment Variables**: Store all sensitive configuration in environment variables

### API Integration Patterns
- Route all external API calls through `/pages/api/*` endpoints
- Use Basic Auth for WordPress API communication (server-side only)
- Implement proper error handling for API failures
- Use SWR for client-side data fetching with appropriate cache strategies
- Handle rate limiting and API quotas gracefully

### Data Export Guidelines
- Use PapaParse for CSV generation
- Implement FileSaver for client-side file downloads
- Mask sensitive information (emails) by default in exports
- Include proper headers and formatting in CSV files
- Provide user feedback during export operations

### Testing Considerations
- Write unit tests for utility functions and API helpers
- Implement integration tests for API routes
- Test authentication flows thoroughly
- Validate data export functionality
- Test responsive design across different screen sizes

## Environment Configuration
Required environment variables:
- `NEXTAUTH_URL`: Application URL
- `NEXTAUTH_SECRET`: NextAuth encryption secret
- `GOOGLE_CLIENT_ID`: Google OAuth client ID
- `GOOGLE_CLIENT_SECRET`: Google OAuth client secret
- `WP_API_URL`: WordPress API base URL
- `WP_API_USER`: WordPress API username
- `WP_API_PASSWORD`: WordPress API password

## Future Enhancements
- Reports and analytics dashboard
- Student drill-down views
- CRM integration
- WooCommerce order tracking
- Automated notifications
- Advanced filtering and search capabilities

## Out of Scope
- External-facing views (internal tool only)
- Automated email notifications (future CRM integration)
- Data persistence beyond API calls
- User management (handled via Google Workspace)
- Payment processing (handled via WooCommerce)

## Best Practices for AI Assistance
When working on this project:
1. Always consider data privacy and security implications
2. Maintain consistency with Material UI design system
3. Follow TypeScript best practices and maintain type safety
4. Implement proper loading states and error handling
5. Test authentication and authorization thoroughly
6. Keep components modular and reusable
7. Document complex business logic clearly
8. Ensure responsive design works across devices
9. Validate all user inputs and API responses
10. Follow Next.js best practices for performance optimization